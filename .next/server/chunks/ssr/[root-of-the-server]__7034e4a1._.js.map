{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/src/lib/auth-client.ts"],"sourcesContent":["import { inferAdditionalFields,organizationClient } from \"better-auth/client/plugins\";\nimport { createAuthClient } from \"better-auth/react\";\nimport type { auth } from \"@/lib/auth\";\n \nconst authClient = createAuthClient({\n  baseURL: process.env.PUBLIC_URL,\n  plugins: [\n    inferAdditionalFields<typeof auth>(),   \n  ],\n});\n\nexport const {signUp, signIn, signOut, useSession} = authClient"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;;;AAGA,MAAM,aAAa,IAAA,uMAAgB,EAAC;IAClC,SAAS,QAAQ,GAAG,CAAC,UAAU;IAC/B,SAAS;QACP,IAAA,6MAAqB;KACtB;AACH;AAEO,MAAM,EAAC,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAC,GAAG","debugId":null}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/src/actions/register_actions.ts"],"sourcesContent":["import { FormValues } from \"@/components/register-form\";\nimport { signUp } from \"@/lib/auth-client\";\nimport { Pool } from \"pg\";\n\nfunction getLettrePromo(anneeScolaire:string, niveau:string){\n  const startYear = parseInt(anneeScolaire.split(\"-\")[0],10);\n  const index = startYear - 2006 - (parseInt(niveau,10)-1); \n      // s'incrire en 3ème année, c'est comme s'être inscrit il y a deux ans en première année  \n  return String.fromCharCode(\"a\".charCodeAt(0)+((index%26)+26)%26) // +26 pour éviter les négatifs\n}\n\nexport function sanitizePhone(input: string | null | undefined): string | null {\n  if (!input) return null;\n\n  // Supprime tout sauf les chiffres et +\n  let phone = input.replace(/[\\s./-]/g, \"\");\n\n  //Numéro commençant par 0 → transforme en +33\n  if (phone.startsWith(\"0\")) {\n    //console.log(\"catched!!!\")\n    phone = phone.slice(1);\n  }\n\n  // Vérification finale : +33 suivi de 9 chiffres\n  //const regex = /^\\+33[0-9]{9}$/;\n  //if (!regex.test(phone)) return null;\n  const regex = /^[0-9]{9}$/;\n  if (!regex.test(phone)) return null;\n\n  phone=phone.replace(/ /g,\"\")\n  console.log(phone)\n  return phone.replace(/ /g,\"\");// \"+33\"+phone;\n}\n\n\nexport function capitalizeWords(input: string): string {\n  return input\n    .replace(/-+/g,'-')\n    .split(/([ -])/g) // garde les séparateurs espace et tiret\n    .map(segment => {\n      // ne capitalise pas les séparateurs eux-mêmes\n      if (segment === \" \" || segment === \"-\") return segment;\n      return segment.charAt(0).toUpperCase() + segment.slice(1).toLowerCase();\n    })\n    .join(\"\");\n}\n\n   \n// export const formatPhoneWithSpaces = (value: string | null | undefined) => {\n//   if (!value) return \"\";\n\n//   let numero = value;\n//   if (numero.startsWith(\"0\")) {\n//     numero = numero.slice(1);\n//   }\n\n//   let digits = numero.replace(/\\D/g, \"\").slice(0, 9);\n\n//   // Regrouper 1 chiffre puis des groupes de 2\n//   return digits\n//     .replace(/(\\d{1})(\\d{2})(\\d{2})(\\d{2})(\\d{0,2})?/, (_, a, b, c, d, e) =>\n//       [a, b, c, d, e].filter(Boolean).join(\" \")\n//     )\n//     .trim();\n// };\n\n\nexport const formatPhoneWithSpaces = (value: string | null | undefined) => {  \n  if (!value) return \"\";\n\n  let numero=value\n  if (numero.startsWith(\"0\")) {\n    console.log(\"catched!!!\")\n    numero = numero.slice(1);\n  }\n\n  let digits = numero.replace(/\\D/g, \"\"); // supprimer tout sauf les chiffres\n  digits = digits.slice(0, 9); // limiter à 9 chiffres\n  \n\n  if (!digits) return \"\"; // pas de chiffres → retour vide\n\n  let formatted = \"\";\n  let addSpace = false;\n  \n  for (let i = 0; i < digits.length; i++) {\n    formatted += digits[i];\n    if(i==0)\n      formatted += \" \";\n    if (i > 1 && addSpace) {\n      formatted += \" \";\n      addSpace = false;\n    } else {\n      addSpace = true;\n    }\n  }\n  return formatted.trim();\n};\n\n\n// export async function handleSubmit(evt: React.FormEvent<HTMLFormElement>) {\n//   evt.preventDefault();\n//   const formData = new FormData(evt.currentTarget as HTMLFormElement);       \n\n//   const nom = String(formData.get(\"nom\")).toUpperCase();\n//   if (!nom) return { error: \"Please enter your nom\" };\n\n//   const prenom = String(formData.get(\"prenom\"));\n//   if (!prenom) return { error: \"Please enter your prenom\" };\n\n//   const tabPrenom = prenom.split(\" \")\n//   const longu = tabPrenom.length\n//   const name = `${nom[0]}${prenom.split(\" \").slice(0,Math.min(2,longu)).join(\"\")}`\n//     .toLowerCase()\n//     .normalize(\"NFD\")                // décompose caractères accentués\n//     .replace(/\\p{Diacritic}/ug, \"\") // supprime diacritiques\n//     .replace(/[^a-z]/g, \"\");\n\n//   const email = String(formData.get(\"email\"));\n//   if (!email) return { error: \"Please enter your email\" };\n\n//   const password = String(formData.get(\"password\"));\n//   if (!password) return { error: \"Please enter your password\" };\n\n//   const civilite = String(formData.get(\"civilite\"));\n//   //console.log(civilite)\n\n//   const pre_phone = formData.get(\"phone\")\n//   //const phone = pre_phone ? formatPhoneWithSpaces(String(pre_phone).trim()) : null;\n//   const tarif = String(formData.get(\"tarif\"))\n//   const typeContrat = String(formData.get(\"typeContrat\"))\n//   //const emaileseo = String(formData.get(\"emaileseo\"))\n//   const role = String(formData.get(\"role\"))\n\n//   const annee = String(formData.get(\"annee\"))\n//   console.log(annee)\n\n//   const niveau = String(formData.get(\"niveau\"))\n//   console.log(`niveau: ${niveau}`)\n\n//   const promoOrigine=String.fromCharCode(\n//     parseInt(annee.split('-')[0])-parseInt(niveau)+1-2006+96\n//   )\n\n//   //console.log(promoOrigine)\n//   //console.log(role)\n//   //console.log(parseInt(annee.split('–')[0])-parseInt(niveau)+1-2006+96)\n\n//   let metadata:string[] = []  \n//   if (role==\"ELING\")\n//     metadata = [annee,niveau]\n//   else if (role==\"VACAT\")\n//     metadata = [tarif,typeContrat]\n//   const id=name\n//   const user =  await signUp.email({ id ,name, email, password, nom, prenom, civilite, role, \"phoneNumber\":phone||null, metadata})\n\n  \n// }\n\nexport async function onSubmitServer(data: FormValues) {\n  // 1) Validation simple équivalente à tes checks\n  const nom = data.nom?.toUpperCase();\n  if (!nom) return { error: \"Please enter your nom\" };\n\n  const prenom = data.prenom;\n  if (!prenom) return { error: \"Please enter your prenom\" };\n\n  // 2) Construction du \"name\"\n  const tabPrenom = prenom.split(\" \");\n  const longu = tabPrenom.length;\n\n  const name = `${nom[0]}${prenom.split(\" \").slice(0, Math.min(2, longu)).join(\"\")}`\n    .toLowerCase()\n    .normalize(\"NFD\")\n    .replace(/\\p{Diacritic}/ug, \"\")\n    .replace(/[^a-z]/g, \"\");\n\n  const nomNorma = nom.replace(\" \",\"\").toLowerCase().normalize(\"NFD\").replace(/\\p{Diacritic}/ug, \"\").replace(/[^a-z]/g, \"\");\n  const prenomNorma = prenom.replace(\" \",\"\").toLowerCase().normalize(\"NFD\").replace(/\\p{Diacritic}/ug, \"\").replace(/[^a-z]/g, \"\");\n  const emaileseoPrefixe = `${prenomNorma}.${nomNorma}`\n  // 3) Email & password\n\n  const email = data.email;\n  if (!email) return { error: \"Please enter your email\" };\n\n  const password = data.password;\n  if (!password) return { error: \"Please enter your password\" };\n\n  // 4) Civilité / téléphone / role / metadata\n  const civilite = data.civilite;\n\n  //const phone = data.phoneNumber\n  //console.log(phone)\n  let phone = data.phoneNumber;\n  if (phone) {\n    // 1. Nettoyage de sécurité (espaces, points...)\n    phone = phone.replace(/[\\s.\\-\\/]/g, \"\");\n\n    // 2. Gestion du format\n    // Si l'utilisateur a tapé \"06...\", on enlève le 0\n    if (phone.startsWith(\"0\")) {\n      phone = phone.slice(1);\n    }\n\n    // 3. Ajout du +33 pour respecter la contrainte SQL CHECK (telephone_fixe ~ '^\\+33...')\n    if (!phone.startsWith(\"+33\")) {\n      phone = \"+33\" + phone;\n    }\n  }\n  //toast.success(phone)\n    //? formatPhoneWithSpaces(String(data.phone).trim())\n    //: null;\n\n  const role = data.role;\n\n  const tarif = data.tarif;\n  const typeContrat = data.typeContrat;\n\n  const forma = data.forma\n  const annee = data.annee;\n  const niveau = data.niveau;\n  // 5) Calcul promoOrigine\n  const promoOrigine = String.fromCharCode(\n    parseInt(annee.split(\"-\")[0]) - parseInt(niveau) + 1 - 2006 + 96\n  );\n  \n\n  // 6) Metadata selon rôle\n  let metadata: string[] = [];\n  if (role === \"ELING\") metadata = [forma, promoOrigine, emaileseoPrefixe];\n  else if (role === \"VACAT\") metadata = [tarif, typeContrat, emaileseoPrefixe];\n\n  // 7) User ID final\n  const id = name;\n\n  // 8) Appel à better-auth équivalent à ton ancienne version\n  const user = await signUp.email({\n    id,\n    name,\n    email,\n    password,\n    nom,\n    prenom,\n    civilite,\n    role,\n    phoneNumber: phone || null,\n    metadata,\n  });\n\n  return { success: true, user };\n}\n\n\n\nexport async function generateUniqueName(name: string, pool:Pool) {\n  const base = name\n  let username = name;\n  let count = 1;\n  while (true) {\n    try {\n      // Tentative d'insertion temporaire via SELECT EXISTS pour vérifier unicité\n      const result = await pool.query(\n        'SELECT 1 FROM \"user\" WHERE name = $1',\n        [username]\n      );\n      if (result.rowCount === 0) {\n        return username; // unique => on retourne\n      } else {\n        username = `${base}${count}`; // sinon on incrémente\n        count++;\n      }\n    } catch (err) {\n      console.error(\"Erreur lors de la vérification du username\", err);\n      throw err;\n    }\n  }\n}\n\n\nexport async function generateUniqueEmailEseo(name: string, table: string, pool:Pool) {\n  const [base, suffixe] = name.split(\"@\")\n  let prefixe = base;\n  let count = 1;\n  while (true) {\n    try {\n      // Tentative d'insertion temporaire via SELECT EXISTS pour vérifier unicité\n      const result = await pool.query(\n        'SELECT 1 FROM '+table+' WHERE emaileseo = $1',\n        [prefixe+\"@\"+suffixe]\n      );\n      if (result.rowCount === 0) {\n        return prefixe; // unique => on retourne\n      } else {\n        prefixe = `${base}${count}`; // sinon on incrémente\n        count++;\n      }\n    } catch (err) {\n      console.error(\"Erreur lors de la vérification du username\", err);\n      throw err;\n    }\n  }\n}\n\n\n// autre méthode, \n      //SELECT NOT EXISTS (\n    //SELECT 1 FROM \"user\" WHERE maileseo = $1\n  //);"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/src/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { phoneNumber } from \"better-auth/plugins\";\nimport { nextCookies } from \"better-auth/next-js\";\nimport { Pool } from \"pg\";\nimport { generateUniqueEmailEseo, generateUniqueName } from \"@/actions/register_actions\";\nimport { type FormValues } from \"@/components/register-form\";\n\n// 1. Définition de l'interface pour typer le \"user\" dans les hooks\n// Cela dit à TypeScript : \"T'inquiète, ces champs existent bien.\"\ninterface UserWithCustomFields {\n  id?: string;\n  email: string;\n  name?: string;\n  role?: string;\n  metadata?: string[]; // Notre champ custom\n  phoneNumber?: string;\n  emailVerified?: boolean;\n  createdAt?: Date;\n  updatedAt?: Date;\n}\n\nconst JASMIN_HOST = process.env.JASMIN_HOST;\nconst JASMIN_USER = process.env.JASMIN_USER;\nconst JASMIN_PASSWORD = process.env.JASMIN_PASSWORD;\n\nexport const pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  // options: \"-c search_path=sys\" // Parfois nécessaire, parfois non selon ton setup\n});\n\nexport const auth = betterAuth({\n  emailAndPassword: {\n    enabled: true,\n  },\n  database: pool,\n  user: {\n    additionalFields: {\n      metadata: { type: \"string[]\", required: false },\n      // id, nom, prenom sont déjà gérés ou partiels, mais on peut les forcer si besoin\n      // Note: \"id\" est natif, pas besoin de le mettre dans additionalFields sauf cas rare\n      nom: { type: \"string\", required: false },\n      prenom: { type: \"string\", required: false },\n      civilite: { type: \"string\", required: false },\n      phoneNumber: { type: \"string\", required: false },\n      role: { type: \"string\", required: false, defaultValue: \"USER\" },\n      banned: { type: \"boolean\", required: false },\n      ban_reason: { type: \"string\", required: false },\n      ban_expires: { type: \"date\", required: false },\n    },\n  },\n  databaseHooks: {\n    user: {\n      create: {\n        // \"context\" est le 2eme argument, on ne l'utilise pas ici mais il faut respecter la signature\n        before: async (user: any) => { \n          // J'utilise 'any' temporairement ici pour débloquer ton rouge sur 'id'/'name'\n          // car le type inferré par BetterAuth est strict avant la création.\n          \n          // Logique de génération de nom unique\n          const newName = await generateUniqueName(user.name, pool);\n          \n          return {\n            data: {\n              ...user,\n              name: newName,\n              id: newName, // On force l'ID égal au username\n            }\n          };\n        },\n        after: async (user: any) => {\n          // On caste user en \"any\" ou notre interface pour accéder à metadata sans erreur\n          const typedUser = user as UserWithCustomFields;\n          \n          // Sécurité : si pas de metadata, on ne fait rien (évite le crash)\n          if (!typedUser.metadata || !typedUser.role) return;\n\n          const maxRetries = 10;\n          let attempt = 0;\n\n          // ========================\n          // GESTION VACATAIRE\n          // ========================\n          if (typedUser.role === \"VACAT\") {\n            while (attempt < maxRetries) {\n              try {\n                // metadata[2] est le préfixe email\n                const prefixe = await generateUniqueEmailEseo(typedUser.metadata[2] + \"@eseo.fr\", \"sys.prof\", pool);\n                const fullEmail = `${prefixe}@eseo.fr`;\n\n                await pool.query(\n                  `INSERT INTO sys.prof(id, emaileseo, tarif, \"typeContrat\") VALUES ($1,$2,$3,$4)`,\n                  [typedUser.id, fullEmail, parseFloat(typedUser.metadata[0]), typedUser.metadata[1]]\n                );\n                break; \n              } catch (err: any) {\n                if (err.code === '23505') { // Code erreur Unique Violation\n                  attempt++;\n                  continue;\n                }\n                // Rollback manuel (compensation)\n                await pool.query(`DELETE FROM sys.user WHERE id=$1`, [typedUser.id]);\n                throw err;\n              }\n            }\n          }\n\n          // ========================\n          // GESTION ETUDIANT\n          // ========================\n          if (typedUser.role === \"ELING\") {\n            attempt = 0;\n            while (attempt < maxRetries) {\n              try {\n                const prefixe = await generateUniqueEmailEseo(typedUser.metadata[2] + \"@reseau.eseo.fr\", \"sys.eling\", pool);\n                const fullEmail = `${prefixe}@reseau.eseo.fr`;\n                const promoOrigine = typedUser.metadata[1] + typedUser.metadata[0].toLowerCase();\n\n                await pool.query(\n                  `INSERT INTO sys.eling(id, forma, \"promoOrigine\", promo, gr, emaileseo)\n                   VALUES ($1,$2,$3,$4,$5,$6)`,\n                  [typedUser.id, typedUser.metadata[0], promoOrigine, promoOrigine, promoOrigine + \"1\", fullEmail]\n                );\n                break;\n              } catch (err: any) {\n                if (err.code === '23505') {\n                  attempt++;\n                  continue;\n                }\n                await pool.query(`DELETE FROM sys.user WHERE id=$1`, [typedUser.id]);\n                throw err;\n              }\n            }\n          }\n        },\n      },\n    },\n  },\n  plugins: [\n    nextCookies(), // Si ce plugin est toujours rouge, supprime-le, il est optionnel dans les dernières versions Next.js\n    phoneNumber({\n      sendOTP: async ({ phoneNumber, code }, request) => {\n        // Ta logique d'envoi OTP existante\n        // ... (ton code Jasmin)\n        console.log(`OTP envoyé à ${phoneNumber}: ${code}`);\n      },\n    }),\n  ],\n});\n\nexport type Session = typeof auth.$Infer.Session;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 436, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/src/actions/schedule_actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { pool } from \"@/lib/auth\"; // Ton pool Postgres existant\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n// Récupérer tous les cours pour le calendrier\r\nexport async function getLessons(start: Date, end: Date) {\r\n  // On joint avec sys.prof pour avoir le nom du prof\r\n  // On joint avec scol.ue pour le titre (si besoin)\r\n  const result = await pool.query(`\r\n    SELECT \r\n      l.id, \r\n      l.deb as start, \r\n      l.fin as \"end\", \r\n      l.salle as \"resourceId\",\r\n      l.typec as type,\r\n      p.nom || ' ' || p.prenom as prof,\r\n      u.label as title\r\n    FROM scol.lecon l\r\n    LEFT JOIN sys.prof p ON l.\"profId\" = p.id\r\n    LEFT JOIN scol.ue u ON l.\"ueId\" = u.id\r\n    WHERE l.deb >= $1 AND l.fin <= $2\r\n  `, [start, end]);\r\n\r\n  // Conversion des dates pour que React comprenne\r\n  return result.rows.map(row => ({\r\n    ...row,\r\n    start: new Date(row.start),\r\n    end: new Date(row.end),\r\n    // Couleur conditionnelle selon le type (facultatif)\r\n    bgColor: row.type === 'TP' ? '#ef4444' : '#3b82f6'\r\n  }));\r\n}\r\n\r\n// Déplacer un cours (Drag & Drop)\r\nexport async function moveLesson(lessonId: string, newStart: Date, newEnd: Date, newRoomId: string) {\r\n  \r\n  // 1. DÉTECTION DE CONFLIT (Ta règle d'or)\r\n  // \"Est-ce qu'il existe un AUTRE cours dans la MÊME salle qui CHEVAUCHE mes horaires ?\"\r\n  const conflict = await pool.query(\r\n    `SELECT l.id, p.nom \r\n     FROM scol.lecon l\r\n     LEFT JOIN sys.prof p ON l.\"profId\" = p.id\r\n     WHERE l.salle = $1 \r\n       AND l.id != $2 -- On ne se compte pas soi-même\r\n       AND tstzrange(l.deb, l.fin) && tstzrange($3, $4) -- L'opérateur \"overlap\" de Postgres\r\n    `,\r\n    [newRoomId, lessonId, newStart, newEnd]\r\n  );\r\n\r\n  // S'il y a un résultat, c'est qu'il y a conflit\r\n  if (conflict.rowCount && conflict.rowCount > 0) {\r\n    const occupant = conflict.rows[0].nom || \"un autre prof\";\r\n    return { \r\n      success: false, \r\n      message: `Impossible : La salle est déjà prise par ${occupant} à cette heure.` \r\n    };\r\n  }\r\n\r\n  // 2. SI TOUT EST BON : UPDATE\r\n  try {\r\n    await pool.query(\r\n      `UPDATE scol.lecon SET deb = $1, fin = $2, salle = $3 WHERE id = $4`,\r\n      [newStart, newEnd, newRoomId, lessonId]\r\n    );\r\n    \r\n    // On rafraîchit les données de la page pour que tout le monde voie le changement\r\n    revalidatePath('/admin/planning'); \r\n    return { success: true };\r\n    \r\n  } catch (error) {\r\n    console.error(error);\r\n    return { success: false, message: \"Erreur technique lors de la sauvegarde.\" };\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;AAEA,sMAAmC,6BAA6B;AAChE;;;;;;;;;AAGO,eAAe,WAAW,KAAW,EAAE,GAAS;IACrD,mDAAmD;IACnD,kDAAkD;IAClD,MAAM,SAAS,MAAM,0HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;;;;;;EAajC,CAAC,EAAE;QAAC;QAAO;KAAI;IAEf,gDAAgD;IAChD,OAAO,OAAO,IAAI,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;YAC7B,GAAG,GAAG;YACN,OAAO,IAAI,KAAK,IAAI,KAAK;YACzB,KAAK,IAAI,KAAK,IAAI,GAAG;YACrB,oDAAoD;YACpD,SAAS,IAAI,IAAI,KAAK,OAAO,YAAY;QAC3C,CAAC;AACH;AAGO,eAAe,WAAW,QAAgB,EAAE,QAAc,EAAE,MAAY,EAAE,SAAiB;IAEhG,0CAA0C;IAC1C,uFAAuF;IACvF,MAAM,WAAW,MAAM,0HAAI,CAAC,KAAK,CAC/B,CAAC;;;;;;IAMD,CAAC,EACD;QAAC;QAAW;QAAU;QAAU;KAAO;IAGzC,gDAAgD;IAChD,IAAI,SAAS,QAAQ,IAAI,SAAS,QAAQ,GAAG,GAAG;QAC9C,MAAM,WAAW,SAAS,IAAI,CAAC,EAAE,CAAC,GAAG,IAAI;QACzC,OAAO;YACL,SAAS;YACT,SAAS,CAAC,yCAAyC,EAAE,SAAS,eAAe,CAAC;QAChF;IACF;IAEA,8BAA8B;IAC9B,IAAI;QACF,MAAM,0HAAI,CAAC,KAAK,CACd,CAAC,kEAAkE,CAAC,EACpE;YAAC;YAAU;YAAQ;YAAW;SAAS;QAGzC,iFAAiF;QACjF,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IAEzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO;YAAE,SAAS;YAAO,SAAS;QAA0C;IAC9E;AACF;;;IApEsB;IA6BA;;AA7BA,+OAAA;AA6BA,+OAAA","debugId":null}},
    {"offset": {"line": 540, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/.next-internal/server/app/admin/planning/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getLessons as '609f5083cd142be32326bfd72defa2b0c9f333cfa1'} from 'ACTIONS_MODULE0'\nexport {moveLesson as '78d72177924ee7672c912479bca8d305f803e355b9'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 576, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/src/components/planning-calendar.tsx"],"sourcesContent":["// \"use client\";\r\n\r\n// import React, { useState, useCallback } from \"react\";\r\n// import { Calendar, dateFnsLocalizer, Views, View } from \"react-big-calendar\";\r\n// import withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\r\n// import { format, parse, startOfWeek, getDay } from \"date-fns\";\r\n// import { fr } from \"date-fns/locale\";\r\n// import { X, MapPin, User, Users, Clock, BookOpen } from \"lucide-react\"; // Icônes pour le style\r\n\r\n// import \"react-big-calendar/lib/css/react-big-calendar.css\";\r\n// import \"react-big-calendar/lib/addons/dragAndDrop/styles.css\";\r\n\r\n// // --- 1. CONFIGURATION ---\r\n// const locales = { \"fr\": fr };\r\n// const localizer = dateFnsLocalizer({\r\n//   format,\r\n//   parse,\r\n//   startOfWeek,\r\n//   getDay,\r\n//   locales,\r\n// });\r\n\r\n// const DnDCalendar = withDragAndDrop(Calendar);\r\n\r\n// // --- 2. DONNÉES RICHES (MOCKS) ---\r\n// // On ajoute des champs : prof, groupes, type, salles...\r\n// const EVENTS_MOCK = [\r\n//   {\r\n//     id: 1,\r\n//     title: \"Traitement du langage naturel\",\r\n//     type: \"Travaux Pratiques\",\r\n//     groups: \"E5e-Paris-BD, E5e-Paris-IA\",\r\n//     prof: \"TLIG Ghassen\",\r\n//     salles: \"S1.6 - HILBERT, S1.5 - HERTZ\",\r\n//     start: new Date(2025, 3, 10, 8, 45), // 10 Avril à 08h45\r\n//     end: new Date(2025, 3, 10, 12, 45),\r\n//     resourceId: \"salle_hilbert\", \r\n//     bgColor: \"#ef4444\", // Rouge (TP)\r\n//   },\r\n//   {\r\n//     id: 2,\r\n//     title: \"Mathématiques pour l'ingénieur\",\r\n//     type: \"Cours Magistral\",\r\n//     groups: \"Promo E5\",\r\n//     prof: \"DUPONT Jean\",\r\n//     salles: \"Amphi A\",\r\n//     start: new Date(2025, 3, 10, 14, 0),\r\n//     end: new Date(2025, 3, 10, 16, 0),\r\n//     resourceId: \"amphi_a\", \r\n//     bgColor: \"#3b82f6\", // Bleu (CM)\r\n//   },\r\n// ];\r\n\r\n// export default function PlanningCalendar() {\r\n//   const [events, setEvents] = useState(EVENTS_MOCK);\r\n//   const [view, setView] = useState<View>(Views.WORK_WEEK);\r\n//   const [date, setDate] = useState(new Date(2025, 3, 10));\r\n  \r\n//   // État pour la fenêtre de détail (Modale)\r\n//   const [selectedEvent, setSelectedEvent] = useState<any>(null);\r\n\r\n//   // --- GESTION DU DRAG & DROP ---\r\n//   const onEventDrop = useCallback(\r\n//     ({ event, start, end }: any) => {\r\n//       setEvents((prev) => {\r\n//         const filtered = prev.filter((e) => e.id !== event.id);\r\n//         return [...filtered, { ...event, start, end }];\r\n//       });\r\n//     },\r\n//     []\r\n//   );\r\n\r\n//   // --- STYLE DES ÉVÉNEMENTS SUR LE CALENDRIER ---\r\n//   // On personnalise l'apparence de la petite brique dans le planning\r\n//   const eventStyleGetter = (event: any) => {\r\n//     return {\r\n//       style: {\r\n//         backgroundColor: event.bgColor || \"#3b82f6\",\r\n//         borderRadius: \"4px\",\r\n//         opacity: 0.9,\r\n//         color: \"white\",\r\n//         border: \"0px\",\r\n//         display: \"block\",\r\n//         fontSize: \"0.80rem\",\r\n//         padding: \"2px\"\r\n//       },\r\n//     };\r\n//   };\r\n\r\n//   // Composant personnalisé pour l'affichage DANS la case du calendrier\r\n//   const CustomEvent = ({ event }: any) => (\r\n//     <div className=\"flex flex-col h-full overflow-hidden leading-tight\">\r\n//       <span className=\"font-bold text-xs\">{event.title}</span>\r\n//       <span className=\"text-[10px] italic\">{event.type}</span>\r\n//       <div className=\"mt-auto text-[10px] flex items-center gap-1\">\r\n//         <MapPin size={10} /> {event.salles?.split(',')[0]} {/* On affiche juste la 1ere salle si trop long */}\r\n//       </div>\r\n//     </div>\r\n//   );\r\n\r\n//   return (\r\n//     <div className=\"relative\">\r\n//       {/* CALENDRIER */}\r\n//       <div className=\"h-[700px] bg-white p-4 rounded-lg shadow-md text-black border border-gray-200\">\r\n//         <DnDCalendar\r\n//           localizer={localizer}\r\n//           events={events}\r\n          \r\n//           // Interaction\r\n//           onSelectEvent={(event) => setSelectedEvent(event)} // Clic sur un cours\r\n//           draggableAccessor={() => true}\r\n//           resizable\r\n//           onEventDrop={onEventDrop}\r\n//           onEventResize={onEventDrop}\r\n\r\n//           // Vue\r\n//           defaultView={Views.WORK_WEEK}\r\n//           views={[Views.DAY, Views.WORK_WEEK, Views.MONTH]}\r\n//           step={15} // Créneaux de 15 min pour être précis (08h45)\r\n//           showMultiDayTimes\r\n          \r\n//           date={date}\r\n//           onNavigate={setDate}\r\n//           onView={setView}\r\n          \r\n//           // Customisation\r\n//           culture=\"fr\"\r\n//           eventPropGetter={eventStyleGetter}\r\n//           components={{\r\n//             event: CustomEvent // Notre design personnalisé pour la brique\r\n//           }}\r\n          \r\n//           messages={{\r\n//             next: \"Suivant\",\r\n//             previous: \"Précédent\",\r\n//             today: \"Aujourd'hui\",\r\n//             month: \"Mois\",\r\n//             week: \"Semaine\",\r\n//             day: \"Jour\",\r\n//             agenda: \"Agenda\",\r\n//             date: \"Date\",\r\n//             time: \"Heure\",\r\n//             event: \"Cours\",\r\n//             noEventsInRange: \"Aucun cours.\",\r\n//           }}\r\n//         />\r\n//       </div>\r\n\r\n//       {/* --- FENÊTRE DE DÉTAILS (MODALE) --- */}\r\n//       {selectedEvent && (\r\n//         <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n//           <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\r\n            \r\n//             {/* En-tête coloré */}\r\n//             <div \r\n//               className=\"p-4 text-white flex justify-between items-start\"\r\n//               style={{ backgroundColor: selectedEvent.bgColor || '#3b82f6' }}\r\n//             >\r\n//               <div>\r\n//                 <h2 className=\"text-lg font-bold leading-snug\">{selectedEvent.title}</h2>\r\n//                 <span className=\"text-sm opacity-90 block mt-1\">{selectedEvent.type}</span>\r\n//               </div>\r\n//               <button \r\n//                 onClick={() => setSelectedEvent(null)}\r\n//                 className=\"text-white/80 hover:text-white hover:bg-white/20 rounded-full p-1 transition\"\r\n//               >\r\n//                 <X size={20} />\r\n//               </button>\r\n//             </div>\r\n\r\n//             {/* Corps de la modale */}\r\n//             <div className=\"p-6 space-y-4 text-gray-800\">\r\n              \r\n//               {/* Horaires */}\r\n//               <div className=\"flex items-center gap-3 text-lg font-semibold text-gray-900 bg-gray-50 p-3 rounded-lg border border-gray-100\">\r\n//                 <Clock className=\"text-gray-500\" size={20} />\r\n//                 <span>\r\n//                   {format(selectedEvent.start, \"HH'h'mm\")} - {format(selectedEvent.end, \"HH'h'mm\")}\r\n//                 </span>\r\n//               </div>\r\n\r\n//               {/* Groupes */}\r\n//               <div className=\"flex items-start gap-3\">\r\n//                 <Users className=\"text-gray-400 mt-1\" size={18} />\r\n//                 <div>\r\n//                   <p className=\"text-xs text-gray-500 uppercase font-semibold\">Groupes</p>\r\n//                   <p className=\"text-sm font-medium\">{selectedEvent.groups}</p>\r\n//                 </div>\r\n//               </div>\r\n\r\n//               {/* Salles */}\r\n//               <div className=\"flex items-start gap-3\">\r\n//                 <MapPin className=\"text-gray-400 mt-1\" size={18} />\r\n//                 <div>\r\n//                   <p className=\"text-xs text-gray-500 uppercase font-semibold\">Salles</p>\r\n//                   <p className=\"text-sm font-medium\">{selectedEvent.salles}</p>\r\n//                 </div>\r\n//               </div>\r\n\r\n//               {/* Professeur */}\r\n//               <div className=\"flex items-start gap-3\">\r\n//                 <User className=\"text-gray-400 mt-1\" size={18} />\r\n//                 <div>\r\n//                   <p className=\"text-xs text-gray-500 uppercase font-semibold\">Enseignant</p>\r\n//                   <p className=\"text-sm font-medium\">{selectedEvent.prof}</p>\r\n//                 </div>\r\n//               </div>\r\n\r\n//             </div>\r\n\r\n//             {/* Pied de page */}\r\n//             <div className=\"p-4 bg-gray-50 border-t flex justify-end\">\r\n//                 <span className=\"text-xs text-gray-400 px-2 py-1\">ID: {selectedEvent.id}</span>\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n//       )}\r\n//     </div>\r\n//   );\r\n// }\r\n// \"use client\";\r\n\r\n// import React, { useState, useCallback, useEffect } from \"react\";\r\n// import { Calendar, dateFnsLocalizer, Views, View } from \"react-big-calendar\";\r\n// import withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\r\n// import { format, parse, startOfWeek, getDay } from \"date-fns\";\r\n// import { fr } from \"date-fns/locale\";\r\n// import { toast } from \"sonner\"; // Pour afficher les erreurs\r\n// import { moveLesson } from \"@/actions/schedule_actions\"; // Notre Server Action\r\n\r\n// import \"react-big-calendar/lib/css/react-big-calendar.css\";\r\n// import \"react-big-calendar/lib/addons/dragAndDrop/styles.css\";\r\n\r\n// const locales = { \"fr\": fr };\r\n// const localizer = dateFnsLocalizer({ format, parse, startOfWeek, getDay, locales });\r\n// const DnDCalendar = withDragAndDrop(Calendar);\r\n\r\n// // Props : Le composant reçoit désormais les cours depuis le serveur\r\n// interface PlanningProps {\r\n//   initialEvents: any[];\r\n// }\r\n\r\n// export default function PlanningCalendar({ initialEvents }: PlanningProps) {\r\n//   const [events, setEvents] = useState(initialEvents);\r\n//   const [view, setView] = useState<View>(Views.WORK_WEEK);\r\n//   const [date, setDate] = useState(new Date()); // Date d'aujourd'hui par défaut\r\n\r\n//   // Mettre à jour si les props changent (ex: après un refresh serveur)\r\n//   useEffect(() => {\r\n//     setEvents(initialEvents);\r\n//   }, [initialEvents]);\r\n\r\n//   // --- QUAND ON LÂCHE LA SOURIS (DROP) ---\r\n//   const onEventDrop = useCallback(async ({ event, start, end, resourceId }: any) => {\r\n//       // 1. Sauvegarde l'ancien état (pour annuler si erreur)\r\n//       const oldEvents = [...events];\r\n      \r\n//       // 2. Mise à jour Optimiste (On bouge tout de suite pour que ce soit fluide)\r\n//       const updatedEvent = { ...event, start, end, resourceId };\r\n//       setEvents((prev) => prev.map(e => e.id === event.id ? updatedEvent : e));\r\n\r\n//       // 3. Appel au Serveur (Postgres)\r\n//       // Si resourceId est undefined (pas changé de salle), on garde l'ancienne\r\n//       const targetRoom = resourceId || event.resourceId; \r\n      \r\n//       const result = await moveLesson(event.id, start, end, targetRoom);\r\n\r\n//       if (!result.success) {\r\n//         // AÏE : CONFLIT !\r\n//         toast.error(result.message); // Affiche \"Impossible : Salle prise par...\"\r\n//         setEvents(oldEvents); // On remet le cours à sa place d'origine (Rollback)\r\n//       } else {\r\n//         toast.success(\"Cours déplacé avec succès\");\r\n//       }\r\n//     },\r\n//     [events]\r\n//   );\r\n\r\n//   // Style (identique à avant)\r\n//   const eventStyleGetter = (event: any) => ({\r\n//     style: {\r\n//       backgroundColor: event.bgColor || \"#3b82f6\",\r\n//       borderRadius: \"4px\",\r\n//       fontSize: \"0.80rem\",\r\n//       border: \"0px\",\r\n//       display: \"block\",\r\n//     },\r\n//   });\r\n\r\n//   return (\r\n//     <div className=\"h-[700px] bg-white p-4 rounded-lg shadow-md border border-gray-200\">\r\n//       <DnDCalendar\r\n//         localizer={localizer}\r\n//         events={events}\r\n//         draggableAccessor={() => true}\r\n//         resizable\r\n//         onEventDrop={onEventDrop}\r\n//         onEventResize={onEventDrop} // Gère aussi le redimensionnement\r\n        \r\n//         defaultView={Views.WORK_WEEK}\r\n//         views={[Views.DAY, Views.WORK_WEEK, Views.MONTH]}\r\n//         step={15}\r\n//         showMultiDayTimes\r\n        \r\n//         date={date}\r\n//         onNavigate={setDate}\r\n//         onView={setView}\r\n        \r\n//         culture=\"fr\"\r\n//         eventPropGetter={eventStyleGetter}\r\n        \r\n//         // Configuration des ressources (Salles) pour la vue Journée si besoin\r\n//         // resources={...} \r\n        \r\n//         messages={{\r\n//             next: \"Suivant\",\r\n//             previous: \"Précédent\",\r\n//             today: \"Aujourd'hui\",\r\n//             month: \"Mois\",\r\n//             week: \"Semaine\",\r\n//             day: \"Jour\",\r\n//             agenda: \"Agenda\",\r\n//             date: \"Date\",\r\n//             time: \"Heure\",\r\n//             event: \"Cours\",\r\n//         }}\r\n//       />\r\n//     </div>\r\n//   );\r\n// }"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 869, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sabri/Downloads/ESEO/S9/architecture/Veliseo/REP/src/app/admin/planning/page.tsx"],"sourcesContent":["import PlanningCalendar from \"@/components/planning-calendar\";\r\nimport { getLessons } from \"@/actions/schedule_actions\";\r\n\r\nexport default async function PlanningPage() {\r\n  // 1. On définit la plage de dates à charger (ex: Année 2025)\r\n  // Dans une vraie app, on gérerait ça dynamiquement, mais pour la démo on charge large\r\n  const start = new Date(2025, 0, 1); // 1er Janvier\r\n  const end = new Date(2025, 11, 31); // 31 Décembre\r\n\r\n  // 2. On récupère les VRAIS cours depuis Postgres\r\n  const lessons = await getLessons(start, end);\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-800\">Planning Scolaire</h1>\r\n        <div className=\"text-sm text-gray-500\">\r\n          {lessons.length} cours chargés\r\n        </div>\r\n      </div>\r\n      \r\n      {/* 3. On passe les données au calendrier */}\r\n      <PlanningCalendar initialEvents={lessons} />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;;AAEe,eAAe;IAC5B,6DAA6D;IAC7D,sFAAsF;IACtF,MAAM,QAAQ,IAAI,KAAK,MAAM,GAAG,IAAI,cAAc;IAClD,MAAM,MAAM,IAAI,KAAK,MAAM,IAAI,KAAK,cAAc;IAElD,iDAAiD;IACjD,MAAM,UAAU,MAAM,IAAA,gJAAU,EAAC,OAAO;IAExC,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,8OAAC;wBAAI,WAAU;;4BACZ,QAAQ,MAAM;4BAAC;;;;;;;;;;;;;0BAKpB,8OAAC,qJAAgB;gBAAC,eAAe;;;;;;;;;;;;AAGvC","debugId":null}}]
}